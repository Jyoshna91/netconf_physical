from pyats.topology import loader
from genie.testbed import load
from pyats import aetest
import logging

# Load testbed and connect to device
testbed = loader.load("testbed.yaml")
device = testbed.devices['n9k1']
device.connect(alias='nc', via='netconf')

# Set NETCONF timeout
device.nc.timeout = 300

# Edit config
config = '''
<rpc message-id="101" xmlns="urn:ietf:params:xml:ns:netconf:base:1.0">
  <edit-config>
    <target>
      <startup/>
    </target>
    <config xmlns:xc="urn:ietf:params:xml:ns:netconf:base:1.0">
      <top xmlns="http://example.com/schema/1.2/config">
        <interface>
          <name>Ethernet1/5</name>
          <address>
            <name>192.168.6.1</name>
            <prefix-length>24</prefix-length>
          </address>
        </interface>
      </top>
    </config>
  </edit-config>
</rpc>
'''
# Send the RPC to the device
#result = device.nc.config(config=config)
result = device.nc.edit_config(target='startup', config=config)
print(result)

# Disconnect from the device
output = device.configure("show ip interface brief")
device.disconnect()
