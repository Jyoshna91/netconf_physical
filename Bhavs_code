from ncclient import manager
from ncclient.xml_ import to_ele
from yang.connector import Netconf

# Define connection parameters
host = "2.3.4.5"
port = 830
username = "admin"
password = "admin"

# Define the XML command request
command_request = """
<?xml version="1.0"?>
<nf:rpc xmlns:nf="urn:ietf:params:xml:ns:netconf:base:1.0"
        xmlns:nxos="http://www.cisco.com/nxos:1.0"
        message-id="110">
  <nxos:exec-command>
    <nxos:cmd>show ip interface brief</nxos:cmd>
  </nxos:exec-command>
</nf:rpc>
"""

def execute_command():
    with manager.connect(host=host, port=port, username=username, password=password, hostkey_verify=False) as m:
        print("NETCONF Connected")

        # Initialize the Netconf session with yang.connector.netconf
        device = Netconf(m)

        # Convert the command request to an XML element
        command_rpc = to_ele(command_request)

        # Send the RPC request
        try:
            reply_command = device.request(command_request)
            # Print the response
            print("Response:")
            print(reply_command)
        except Exception as e:
            print("Error: {}".format(e))
        finally:
            # Disconnect from the device
            device.disconnect()
            print("NETCONF Disconnected")

if __name__ == "__main__":
    execute_command()
