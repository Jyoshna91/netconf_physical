from pyats.topology import Device

# Define connection parameters
device_params = {
    'name': 'asr22',
    'type': 'ASR',
    'connections': {
        'netconf': {
            'class': 'yang.connector.Netconf',
            'ip': '2.3.4.5',  # Replace with the actual IP address of your device
            'port': 830,  # NETCONF port
            'username': 'admin',  # NETCONF username
            'password': 'admin',  # NETCONF password
        }
    }
}

# Create a Device instance
device = Device(**device_params)

# Connect to the device
device.connect(alias='nc', via='netconf')
if device.nc.connected:
    print("NETCONF Connected")

    # Define the NETCONF request for "show ip interface brief"
    netconf_request = """
    <rpc xmlns="urn:ietf:params:xml:ns:netconf:base:1.0" message-id="101">
      <exec-command xmlns="http://www.cisco.com/nxos:1.0">
        <cmd>show ip interface brief</cmd>
      </exec-command>
    </rpc>
    """

    # Send the NETCONF request and get the response
    try:
        reply = device.nc.request(netconf_request)
        print("Response:")
        print(reply)
    except Exception as e:
        print(f"Error: {e}")

    # Disconnect from the device
    device.nc.disconnect()
    print("NETCONF Disconnected")
else:
    print("NETCONF Connection Failed")
