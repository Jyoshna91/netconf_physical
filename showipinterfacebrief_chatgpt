from ncclient import manager
from ncclient.xml_ import to_ele

# Define connection parameters
host = "10.133.35.148"
username = "admin"
password = "tcs123"

# Define the XML filter with the configuration commands to be executed
xml_filter = """
<rpc message-id="110" xmlns="urn:ietf:params:xml:ns:netconf:base:1.0">
  <cli-config-data>
    <cmd>conf t</cmd>
    <cmd>interface ethernet 1/5</cmd>
    <cmd>no switchport</cmd>
    <cmd>ip address 10.10.10.1/24</cmd>
    <cmd>no shutdown</cmd>
  </cli-config-data>
</rpc>
"""

def execute_command():
    with manager.connect(host=host, port=830, username=username, password=password, hostkey_verify=False) as m:
        print("NETCONF Connected")

        # Check device capabilities to verify namespaces
        for capability in m.server_capabilities:
            print(capability)

        # Convert the XML string to an element
        rpc = to_ele(xml_filter)
        
        # Send the RPC request
        try:
            res = m.dispatch(rpc)
            # Print the response
            print("Response:")
            print(res.xml)
        except Exception as e:
            print("Error: {}".format(e))

if __name__ == "__main__":
    execute_command()
