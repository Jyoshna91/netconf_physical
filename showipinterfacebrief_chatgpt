from ncclient import manager
from ncclient.xml_ import to_ele

# Define connection parameters
host = "10.133.35.148"
username = "admin"
password = "tcs123"

# Define the XML configuration to be executed
xml_filter = """
<rpc message-id="16" xmlns="urn:ietf:params:xml:ns:netconf:base:1.0">
  <edit-config>
    <target>
      <running/>
    </target>
    <config>
      <configure xmlns="http://www.cisco.com/nxos:1.0:if_manager">
        <__XML__MODE__exec_configure>
          <interface>
            <ethernet>
              <interface>1/5</interface>
              <__XML__MODE_if-ethernet>
                <__XML__MODE_if-eth-base>
                  <description>
                    <desc_line>Configured via NETCONF</desc_line>
                  </description>
                  <ip>
                    <address>
                      <primary>
                        <address>10.10.10.1</address>
                        <mask>255.255.255.0</mask>
                      </primary>
                    </address>
                  </ip>
                  <shutdown operation="delete"/>
                </__XML__MODE_if-eth-base>
              </__XML__MODE_if-ethernet>
            </ethernet>
          </interface>
        </__XML__MODE__exec_configure>
      </configure>
    </config>
  </edit-config>
</rpc>
"""

def execute_command():
    with manager.connect(host=host, port=830, username=username, password=password, hostkey_verify=False) as m:
        print("NETCONF Connected")

        # Convert the XML string to an element
        rpc = to_ele(xml_filter)
        
        # Send the RPC request
        try:
            res = m.dispatch(rpc)
            # Print the response
            print("Response:")
            print(res.xml)
        except Exception as e:
            print(f"Error: {e}")

if __name__ == "__main__":
    execute_command()
